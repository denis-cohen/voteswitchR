## Operations involving replace by numeric / original variable values
replace_jk_orig <- replace_jk %>%
dplyr::filter(replace_type == "orig")
replace_values_jk <-
paste0(
"data_j %>% dplyr::mutate(",
expname_jk,
" = ",
replace_jk_orig$replace_by[r],
")"
)
replace_values_jk
replace_values_jk <-
paste0(
"with(data_j, dplyr::case_when(",
paste0(
replace_jk_orig$replace_if[r],
" ~ ",
replace_jk_orig$replace_by[r]
),
", TRUE ~ ",
expname_jk,
"))"
)
replace_values_jk
library(dplyr)
library(usethis)
library(readr)
available_data <-
readr::read_csv("../dat/map/available_data.csv") %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list(~ na_if(., ""))) %>%
dplyr::mutate(
strength1 = pid_strength,
strength2 = pid_strength
) %>%
dplyr::select(-any_of(c("elec_id_old",
"do_file",
"pid_strength"))) %>%
as.data.frame()
recodes <- read.csv("../dat/map/recodes.csv")  %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list( ~ na_if(., ""))) %>%
as.data.frame()
mappings <- paste0(
"https://docs.google.com/spreadsheets/d/",
"1YUEoX3oXrUNVCa0Pk3JWCHDVGUz94mLlglLN_vwWkVY/edit#gid=1400953196"
) %>%
googlesheets4::read_sheet(sheet = "mappings",
na = c("", "NA"),
trim_ws = TRUE)
mappings <- mappings %>%
dplyr::select(-contains("gender"),-ends_with("_aux")) %>%
group_by(elec_id) %>%
mutate(stack = row_number()) %>%
ungroup() %>%
as.data.frame()
concepts_df <- readr::read_csv("../dat/map/concepts.csv") %>%
as.data.frame()
codebook <- read.csv("../dat/map/codebook.csv") %>%
rename(`Source(s)` = Source.s.) %>%
as_tibble()
data_guide <- available_data %>%
dplyr::select(
country_name,
year,
elec_id,
source,
version_dataset,
download_link,
data_access
) %>%
dplyr::mutate(
data_access = dplyr::case_when(
data_access == 1 ~ "accept terms of use",
data_access == 2 ~ "register and accept terms of use",
data_access == 3 ~ "request access with specific research proposal",
data_access == 4 ~ "request access with specific research proposal and sign data use agreement",
data_access == 5 ~ "request access",
data_access == 6 ~ "request access and pay provision fee"
)
) %>%
as_tibble()
## Internal data
usethis::use_data(available_data,
recodes,
mappings,
concepts_df,
internal = TRUE,
overwrite = TRUE)
## External data
usethis::use_data(mappings,
codebook,
data_guide,
internal = FALSE,
overwrite = TRUE)
library(dplyr)
library(usethis)
library(readr)
available_data <-
readr::read_csv("../dat/map/available_data.csv") %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list(~ na_if(., ""))) %>%
dplyr::mutate(
strength1 = pid_strength,
strength2 = pid_strength
) %>%
dplyr::select(-any_of(c("elec_id_old",
"do_file",
"pid_strength"))) %>%
as.data.frame()
recodes <- read.csv("../dat/map/recodes.csv")  %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list( ~ na_if(., ""))) %>%
as.data.frame()
mappings <- paste0(
"https://docs.google.com/spreadsheets/d/",
"1YUEoX3oXrUNVCa0Pk3JWCHDVGUz94mLlglLN_vwWkVY/edit#gid=1400953196"
) %>%
googlesheets4::read_sheet(sheet = "mappings",
na = c("", "NA"),
trim_ws = TRUE)
1
mappings <- mappings %>%
dplyr::select(-contains("gender"),-ends_with("_aux")) %>%
group_by(elec_id) %>%
mutate(stack = row_number()) %>%
ungroup() %>%
as.data.frame()
concepts_df <- readr::read_csv("../dat/map/concepts.csv") %>%
as.data.frame()
codebook <- read.csv("../dat/map/codebook.csv") %>%
rename(`Source(s)` = Source.s.) %>%
as_tibble()
data_guide <- available_data %>%
dplyr::select(
country_name,
year,
elec_id,
source,
version_dataset,
download_link,
data_access
) %>%
dplyr::mutate(
data_access = dplyr::case_when(
data_access == 1 ~ "accept terms of use",
data_access == 2 ~ "register and accept terms of use",
data_access == 3 ~ "request access with specific research proposal",
data_access == 4 ~ "request access with specific research proposal and sign data use agreement",
data_access == 5 ~ "request access",
data_access == 6 ~ "request access and pay provision fee"
)
) %>%
as_tibble()
## Internal data
usethis::use_data(available_data,
recodes,
mappings,
concepts_df,
internal = TRUE,
overwrite = TRUE)
## External data
usethis::use_data(mappings,
codebook,
data_guide,
internal = FALSE,
overwrite = TRUE)
list.dirs("../dat/nes")
cbind(1:132, list.dirs("../dat/nes"))
library(dplyr)
library(usethis)
library(readr)
available_data <-
readr::read_csv("../dat/map/available_data.csv") %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list(~ na_if(., ""))) %>%
dplyr::mutate(
strength1 = pid_strength,
strength2 = pid_strength
) %>%
dplyr::select(-any_of(c("elec_id_old",
"do_file",
"pid_strength"))) %>%
as.data.frame()
recodes <- read.csv("../dat/map/recodes.csv")  %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list( ~ na_if(., ""))) %>%
as.data.frame()
mappings <- paste0(
"https://docs.google.com/spreadsheets/d/",
"1YUEoX3oXrUNVCa0Pk3JWCHDVGUz94mLlglLN_vwWkVY/edit#gid=1400953196"
) %>%
googlesheets4::read_sheet(sheet = "mappings",
na = c("", "NA"),
trim_ws = TRUE)
mappings <- mappings %>%
dplyr::select(-contains("gender"),-ends_with("_aux")) %>%
group_by(elec_id) %>%
mutate(stack = row_number()) %>%
ungroup() %>%
as.data.frame()
concepts_df <- readr::read_csv("../dat/map/concepts.csv") %>%
as.data.frame()
codebook <- read.csv("../dat/map/codebook.csv") %>%
rename(`Source(s)` = Source.s.) %>%
as_tibble()
data_guide <- available_data %>%
dplyr::select(
country_name,
year,
elec_id,
source,
version_dataset,
download_link,
data_access
) %>%
dplyr::mutate(
data_access = dplyr::case_when(
data_access == 1 ~ "accept terms of use",
data_access == 2 ~ "register and accept terms of use",
data_access == 3 ~ "request access with specific research proposal",
data_access == 4 ~ "request access with specific research proposal and sign data use agreement",
data_access == 5 ~ "request access",
data_access == 6 ~ "request access and pay provision fee"
)
) %>%
as_tibble()
## Internal data
usethis::use_data(available_data,
recodes,
mappings,
concepts_df,
internal = TRUE,
overwrite = TRUE)
## External data
usethis::use_data(mappings,
codebook,
data_guide,
internal = FALSE,
overwrite = TRUE)
data_guide
data_guid$data_access
data_guide$data_access
table(data_guide$data_access)
## Detach if loaded
if ("voteswitchR" %in% (.packages())) {
detach(package:voteswitchR, unload = TRUE)
}
# Uninstall if installed
if ("voteswitchR" %in% installed.packages()) {
remove.packages("voteswitchR")
}
# Install if not installed
if (!("devtools" %in% installed.packages())) {
install.packages("devtools")
}
# Load from GitHub
library(devtools)
devtools::install_github("denis-cohen/voteswitchR",
auth_token = "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",
force = TRUE)
# Load package and execute function
library(voteswitchR)
voteswitchR::build_data_file()
library(shinyalert)
?shinyalert::useShinyalert
devtools::install_github("denis-cohen/voteswitchR",
auth_token = "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",
force = TRUE)
voteswitchR::build_data_file()
devtools::document()
3+3
library(dplyr)
library(usethis)
library(readr)
available_data <-
readr::read_csv("../dat/map/available_data.csv") %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list(~ na_if(., ""))) %>%
dplyr::mutate(
strength1 = pid_strength,
strength2 = pid_strength
) %>%
dplyr::select(-any_of(c("elec_id_old",
"do_file",
"pid_strength"))) %>%
as.data.frame()
recodes <- read.csv("../dat/map/recodes.csv")  %>%
dplyr::mutate(election_date = as.Date(election_date)) %>%
dplyr::mutate_if(is.character, list( ~ na_if(., ""))) %>%
as.data.frame()
mappings <- paste0(
"https://docs.google.com/spreadsheets/d/",
"1YUEoX3oXrUNVCa0Pk3JWCHDVGUz94mLlglLN_vwWkVY/edit#gid=1400953196"
) %>%
googlesheets4::read_sheet(sheet = "mappings",
na = c("", "NA"),
trim_ws = TRUE)
1
mappings <- mappings %>%
dplyr::select(-contains("gender"),-ends_with("_aux")) %>%
group_by(elec_id) %>%
mutate(stack = row_number()) %>%
ungroup() %>%
as.data.frame()
concepts_df <- readr::read_csv("../dat/map/concepts.csv") %>%
as.data.frame()
codebook <- read.csv("../dat/map/codebook.csv") %>%
rename(`Source(s)` = Source.s.) %>%
as_tibble()
data_guide <- available_data %>%
dplyr::select(
country_name,
year,
elec_id,
source,
version_dataset,
download_link,
data_access
) %>%
dplyr::mutate(
data_access = dplyr::case_when(
data_access == 1 ~ "accept terms of use",
data_access == 2 ~ "register and accept terms of use",
data_access == 3 ~ "request access with specific research proposal",
data_access == 4 ~ "request access with specific research proposal and sign data use agreement",
data_access == 5 ~ "request access",
data_access == 6 ~ "request access and pay provision fee"
)
) %>%
as_tibble()
## Internal data
usethis::use_data(available_data,
recodes,
mappings,
concepts_df,
internal = TRUE,
overwrite = TRUE)
## External data
usethis::use_data(mappings,
codebook,
data_guide,
internal = FALSE,
overwrite = TRUE)
load("C:/denis/Dropbox/Uni/MZES/res/202103_switch/voteswitchR/R/sysdata.rda")
## Vote shares
mappings_shares <- mappings %>%
dplyr::group_by(elec_id) %>%
dplyr::group_modify( ~ dplyr::add_row(.x)) %>%
dplyr::mutate(stack = ifelse(dplyr::row_number() == dplyr::n(),
98L,
stack)) %>%
dplyr::group_modify( ~ dplyr::add_row(.x)) %>%
dplyr::mutate(stack = ifelse(dplyr::row_number() == dplyr::n(),
99L,
stack)) %>%
dplyr::mutate(
vote_share = ifelse(stack == 98L,
1 - sum(vote_share, na.rm = T),
vote_share),
vote_share_lag = ifelse(stack == 98L,
1 - sum(vote_share_lag, na.rm = T),
vote_share_lag)
) %>%
dplyr::mutate(vote_share = vote_share * dplyr::first(turnout),
vote_share_lag = vote_share_lag * dplyr::first(turnout_lag)) %>%
dplyr::mutate(
vote_share = ifelse(stack == 99L,
1 - dplyr::first(turnout),
vote_share),
vote_share_lag = ifelse(stack == 99L,
1 - dplyr::first(turnout_lag),
vote_share_lag)
) %>%
dplyr::select(elec_id, stack, vote_share, vote_share_lag) %>%
dplyr::mutate_at(
.vars = dplyr::vars(vote_share, vote_share_lag),
.funs = ~ ifelse(is.na(.), 0.0, .)
)
library(dplyr)
## Vote shares
mappings_shares <- mappings %>%
dplyr::group_by(elec_id) %>%
dplyr::group_modify( ~ dplyr::add_row(.x)) %>%
dplyr::mutate(stack = ifelse(dplyr::row_number() == dplyr::n(),
98L,
stack)) %>%
dplyr::group_modify( ~ dplyr::add_row(.x)) %>%
dplyr::mutate(stack = ifelse(dplyr::row_number() == dplyr::n(),
99L,
stack)) %>%
dplyr::mutate(
vote_share = ifelse(stack == 98L,
1 - sum(vote_share, na.rm = T),
vote_share),
vote_share_lag = ifelse(stack == 98L,
1 - sum(vote_share_lag, na.rm = T),
vote_share_lag)
) %>%
dplyr::mutate(vote_share = vote_share * dplyr::first(turnout),
vote_share_lag = vote_share_lag * dplyr::first(turnout_lag)) %>%
dplyr::mutate(
vote_share = ifelse(stack == 99L,
1 - dplyr::first(turnout),
vote_share),
vote_share_lag = ifelse(stack == 99L,
1 - dplyr::first(turnout_lag),
vote_share_lag)
) %>%
dplyr::select(elec_id, stack, vote_share, vote_share_lag) %>%
dplyr::mutate_at(
.vars = dplyr::vars(vote_share, vote_share_lag),
.funs = ~ ifelse(is.na(.), 0.0, .)
)
## Internal data
usethis::use_data(available_data,
recodes,
mappings,
mappings_shares,
concepts_df,
internal = TRUE,
overwrite = TRUE)
mapping_shares
mappings_shares
dim(mappings_shares)
dim(voteswitchR::mappings)
get_error <- function(x, y, type) {
if (type == mae) {
return(mean(abs(x - y), na.rm = TRUE))
} else if (type == rmse) {
return(sqrt(mean((x - y) ^ 2, na.rm = TRUE)))
}
}
switches
mappings_shares %>% dplyr::select(-stack) %>% dplyr::group_by(elec_id) %>% dplyr::summarise_all() %>% View()
mappings_shares %>% dplyr::select(-stack) %>% dplyr::group_by(elec_id) %>% dplyr::summarise_all(sum) %>% View()
View(mappings_shares)
devtools::documents()
devtools::document()
devtools::document()
?devtools::document
remotes::install_github("stan-dev/rstantools")
devtools::document()
devtools::build()
devtools::check()
?rstantools
version
example(source)
roxygen2::roxygenize(load_code = sourceDir)
roxygen2::roxygenize(load_code = sourceDir, clean = TRUE)
pkgbuild::compile_dll()
environment()
rstantools::example(source)
rstan::example(source)
roxygen2::example(source)
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
roxygen2::roxygenize()
Sys.getenv()
?rstantools
rstantools::rstan_config()
rstantools::rstan_config()
devtools::document()
rstantools::init_cpp()
rstantools::rstan_config()
3+3
.libPaths()
version
library(rstan)
library(StanHeaders)
library(rstantools)
sessionInfo()
Sys.getenv()
compile_dll()
install.packages("pkgbuild")
install.packages("pkgbuild")
pkgbuild::check_rtools()
pkgbuild::check_compiler()
pkgbuild::clean_dll()
pkgbuild::compile_dll()
rstantools::rstan_config()
?rstantools::rstan_config()
roxygen2::roxygenise(load_code = "source").
roxygen2::roxygenize(load_code = "source").
roxygen2::roxygenize(load_code = "source")
3+3
roxygen2::roxygenize()
library(voteswitchR)
?voteswitchR::calculate_pred_error
roxygen2::roxygenize(load_code = "source")
library(voteswitchR)
?voteswitchR::calculate_meas_error
pkgload::dev_help('calculate_meas_error')
pkgload::load_all()
Sys.which("make")
Sys.getenv("BINPREF")
install.packages("jsonlite", type = "source")
install.packages("jsonlite", type = "source")
dotR <- file.path(Sys.getenv("HOME"), ".R")
if (!file.exists(dotR)) dir.create(dotR)
M <- file.path(dotR, "Makevars.win")
if (!file.exists(M)) file.create(M)
cat("\n CXX14FLAGS += -mtune=native -O3 -mmmx -msse -msse2 -msse3 -mssse3 -msse4.1 -msse4.2",
file = M, sep = "\n", append = FALSE)
devtools::install_version("withr", version="2.2.0")
dotR
install.packages("StanHeaders", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
install.packages("rstan", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
devtools::check()
list.files("/Library/Frameworks/R.framework/Versions/4.2/Resources/library/StanHeaders/include/src/stan")
